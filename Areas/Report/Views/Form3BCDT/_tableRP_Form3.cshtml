@inject Microsoft.Extensions.Localization.IStringLocalizer<QOS.SharedResource> Localizer
@inject Microsoft.Extensions.Localization.IStringLocalizer<QOS.Areas.Report.SharedResource> ReportLocalizer
@model QOS.Areas.Report.Models.Form3_BCDT
@{
    
    var Size_Parameter_Cat = Model.Size_Parameter_Cat;
    var Size_Parameter_CPI = Model.Size_Parameter_CPI;
    var Size_Parameter_TP = Model.Size_Parameter_TP;
    @* decimal DS_L_Min = ConvertToDecimal(Model.DS_L_Min), DS_L_Max = ConvertToDecimal(Model.DS_L_Max);
    decimal DS_W_Min = ConvertToDecimal(Model.DS_W_Min), DS_W_Max = ConvertToDecimal(Model.DS_W_Max);
    decimal DS_L_Min_2 = 10, DS_L_Max_2 = 90;
    decimal DS_W_Min_2 = 10, DS_W_Max_2 = 90; *@
    
}
<style>
    input {
        width: 100%;
    }
</style>
<form id="Form3Report" method="post" asp-action="CreateReport_Form3" asp-controller="Report" asp-area="Report">
    <input type="hidden" id="ReportID" name="ReportID" value="@Model.Report_ID"/>
    <input type="hidden" id="Audit_Time" name="Audit_Time" value="@Model.Audit_Time"/>
<table class="table">
    <tr>
        <td><label>@Localizer["Unit"]</label></td>
        
        <td><label>@ReportLocalizer["CutLeader"]</label></td>
        <td><label>MO </label></td>
        <td><label>@Localizer["Color"] </label></td>     
    </tr>
    <tr>
        <td><input id="UnitField" value="@Model.Unit"/></td>
        <td><input value="@Model.Cut_Leader"/></td>
        <td><input value="@Model.MO"/></td>
        <td><input value="@Model.Color"/></td>

    </tr>
    <tr>
        <td><label>Cuộn </label></td>
        <td><label>Cut Lot </label></td>
        <td><label>Số SP/sơ đồ</label></td>
        <td><label>Số lớp </label></td>     
    </tr>
    <tr>
        <td><input value="@Model.Roll" /></td>
        <td><input value="@Model.Lot" /></td>
        <td><input value="@Model.QTY" /></td>
        <td><input value="@Model.Layer_QTY" /></td>

    </tr>
    <tr>
        <td><label>@ReportLocalizer["CutTableRatio"]: </label></td>
        <td><label>Số SP bàn cắt: </label></td>
        <td><label>Cao bàn cắt(inch): </label></td>
        <td><label>Dài sơ đồ(inch):</label></td>     
    </tr>
    <tr>
        <td><input value="@Model.CutTableRatio"/></td>
        <td><input value="@Model.Cut_QTY"/></td>
        <td><input value="@Model.Cut_Table_Height"/></td>
        <td><input value="@Model.Cut_Table_Long"/></td>
    </tr>
    <tr>
        <td ><label>Chất lượng trải vải: </label><i style="color: red;">(@ReportLocalizer["CheckboxE"])</i></td>
        <td style="padding: 3px; text-align:center;">
                <div>Vải kẻ </div>
                <input type="checkbox" name="F1_chk_vai_ke" value="true" @(Model.vai_ke == true ? "checked" : "") id="F1_chk_loang_mau"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
    </tr>
</table>
<table class="table">
    <tr>
        <td style="padding: 3px; text-align:center;">
                <div>@ReportLocalizer["Fabricsplit"]</div>
                <input type="checkbox" name="F1_chk_noi_vai" value="true" @(Model.noi_vai == true ? "checked" : "") id="F1_chk_noi_vai"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
        <td style="padding: 3px; text-align:center;">
                <div>@ReportLocalizer["Fabrictension"] </div>
                <input type="checkbox" name="F1_chk_cang_vai"  value="true" @(Model.cang_vai == true ? "checked" : "") id="F1_chk_cang_vai"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
        <td style="padding: 3px; text-align:center;">
                <div>@ReportLocalizer["Wrongside"] </div>
                <input type="checkbox" name="F1_chk_sai_mat"   value="true" @(Model.sai_mat == true ? "checked" : "") id="F1_chk_sai_mat"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
        <td style="padding: 3px; text-align:center;">
                <div>@ReportLocalizer["Narrow_Width"] </div>
                <input type="checkbox" name="F1_chk_hep_kho"  value="true" @(Model.hep_kho == true ? "checked" : "") id="F1_chk_hep_kho"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
        <td style="padding: 3px; text-align:center;">
                <div>@ReportLocalizer["dirtfabric"] </div>
                <input type="checkbox" name="F1_chk_ban_vai"  value="true" @(Model.ban_vai == true ? "checked" : "") id="F1_chk_ban_vai"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
    </tr>
    <tr>
        <td style="padding: 3px; text-align:center;">
                <div>@ReportLocalizer["Loc_diagram"]</div>
                <input type="checkbox" name="F1_chk_vi_tri" value="true" @(Model.vi_tri == true ? "checked" : "") id="F1_chk_vi_tri"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
        <td style="padding: 3px; text-align:center;">
                <div>@ReportLocalizer["Slantedfabric"]</div>
                <input type="checkbox" name="F1_chk_vai_nghieng"  value="true" @(Model.vai_nghieng == true ? "checked" : "") id="F1_chk_vai_nghieng"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
        <td style="padding: 3px; text-align:center;">
                <div>@ReportLocalizer["Ware"] </div>
                <input type="checkbox" name="F1_chk_song_vai"   value="true" @(Model.song_vai == true ? "checked" : "") id="F1_chk_song_vai"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
        <td style="padding: 3px; text-align:center;">
                <div>@ReportLocalizer["Notstraight"]</div>
                <input type="checkbox" name="F1_chk_thang_ke"  value="true" @(Model.thang_ke == true ? "checked" : "") id="F1_chk_thang_ke"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
        <td style="padding: 3px; text-align:center;">
                <div>@ReportLocalizer["Differentcolor"]</div>
                <input type="checkbox" name="F1_chk_khac_mau"  value="true" @(Model.khac_mau == true ? "checked" : "") id="F1_chk_khac_mau"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
    </tr>
</table>

<p style="font-weight: bold;"><span style="color: red;">*</span> @ReportLocalizer["QualityFabric"]: <span style="color: red; font-weight: normal; font-style: italic;">(@ReportLocalizer["CheckNot"])</span></p>
<TABLE class="table" style="width: 100%; font-size: 0.8em!important; border: 1px solid gray; ">
    <tr>
        <td style="padding: 3px; text-align:center;">
                <div>@ReportLocalizer["Notch"] </div>
                <input type="checkbox" name="F1_chk_quen_bam"  value="true" @(Model.quen_bam == true ? "checked" : "") id="F1_chk_quen_bam"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
        <td style="padding: 3px; text-align:center;">
                <div>@ReportLocalizer["notchDeep"] </div>
                <input type="checkbox" name="F1_chk_bam_sau"  value="true" @(Model.bam_sau == true ? "checked" : "") id="F1_chk_bam_sau"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
        <td style="padding: 3px; text-align:center;">
                <div>@ReportLocalizer["Cutxoc_xech"]</div>
                <input type="checkbox" name="F1_chk_xoc_xech"  value="true" @(Model.xoc_xech == true ? "checked" : "") id="F1_chk_xoc_xech"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
        <td style="padding: 3px; text-align:center;">
                <div>@ReportLocalizer["NotCut"]</div>
                <input type="checkbox" name="F1_chk_khong_cat"  value="true" @(Model.khong_cat == true ? "checked" : "") id="F1_chk_khong_cat"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
        <td style="padding: 3px; text-align:center;">
                <div>Cắt không gọn </div>
                <input type="checkbox" name="F1_chk_cat_khong_gon"  value="true" @(Model.khong_gon == true ? "checked" : "") id="F1_chk_cat_khong_gon"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
    </tr>
    <tr>
        <td style="padding: 3px; text-align:center;">
                <div>Không đối kẻ khi gập </div>
                <input type="checkbox" name="F1_chk_khong_doi_ke"  value="true" @(Model.doi_ke == true ? "checked" : "") id="F1_chk_khong_doi_ke"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
        <td style="padding: 3px; text-align:center;">
                <div>Không đối xứng khi gập đôi </div>
                <input type="checkbox" name="F1_chk_khong_doi_xung"  value="true" @(Model.doi_xung == true ? "checked" : "") id="F1_chk_khong_doi_xung"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
        <td style="padding: 3px; text-align:center;">
                <div>So lớp đầu và lớp cuối </div>
                <input type="checkbox" name="F1_chk_so_lop"  value="true" @(Model.so_lop == true ? "checked" : "") id="F1_chk_so_lop"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
        <td style="padding: 3px; text-align:center;">
                <div>So bán thành phẩm và dập </div>
                <input type="checkbox" name="F1_chk_so_btp"  value="true" @(Model.so_btp == true ? "checked" : "") id="F1_chk_so_btp"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>

    </tr>
</TABLE>
<br>
<p style="font-weight: bold;"><span style="color: red;">*</span> @ReportLocalizer["TS_afterCut"]:</p>

<table style="width: 100%; padding: 0px; ">
    <tr style="height: 0px;">
        <td style="width: 20%;"></td>
        <td style="width: 13%;"></td>
        <td style="width: 13%;"></td>
        <td style="width: 13%;"></td>
        <td style="width: 13%;"></td>
        <td style="width: 13%;"></td>
        <td style="width: 13%;"></td>
    </tr>

@functions {
    private decimal ConvertToDecimal(string? val)
    {
        if (decimal.TryParse(val, out var num))
            return num;
        return 0;
    }

    public string Show_DS(string dsmin, string dsmax, string x)
    {
        // default màu xanh
        string dscolor = "#360";

        if (!decimal.TryParse(dsmin, out var min)) min = 0;
        if (!decimal.TryParse(dsmax, out var max)) max = 0;
        if (!decimal.TryParse(x, out var value)) value = 0;

        if (value < min || value > max)
        {
            dscolor = "#F00"; // đỏ nếu nằm ngoài khoảng
        }

        return dscolor;
    }
}

@if(!string.IsNullOrEmpty(Size_Parameter_Cat))
{
    Size_Parameter_Cat = Size_Parameter_Cat.Trim('*');
    var arrSizePara = Size_Parameter_Cat.Split('*');
    @for (int i =0; i< arrSizePara.Length; i++){
        var SizePara = arrSizePara[i];
        var arrPara = SizePara.Split('@');

        <tr id="@(i == 0 ? "Cat_R1" : null)" style="width:90%;">
            @* Duyệt các phần tử trong arrPara *@
            <td>
                <input type="text" value="@arrPara.ElementAtOrDefault(0)" style="color:#360; width:80%;" autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara.ElementAtOrDefault(1)" style="color:#360; width:80%;" autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara.ElementAtOrDefault(2)" style="color:#360; width:80%;" autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara.ElementAtOrDefault(3)" style="color:#360; width:80%;" autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara.ElementAtOrDefault(4)" style="color:#360; width:80%;" autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara.ElementAtOrDefault(5)" style="color:#360; width:80%;" autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara.ElementAtOrDefault(6)" style="color:#360; width:80%;" autocomplete="on" />
            </td>
            
        </tr>
    }  
}
else
{
    @* <tr id="Fault_R1">
        <td><input type="text" value="" style="color:#360; width:95%;" autocomplete="on" /></td>
        <td><input type="text" value="Tol" style="color:#360;" autocomplete="on" /></td>
        <td><input type="text" value="0" style="color:#360;" autocomplete="on" /></td>
        <td><input type="text" value="0" style="color:#360;" autocomplete="on" /></td>
        <td><input type="text" value="0" style="color:#360;" autocomplete="on" /></td>
        <td><input type="text" value="0" style="color:#360;" autocomplete="on" /></td>
        <td><input type="text" value="0" style="color:#360;" autocomplete="on" /></td>
    </tr> *@
}
<tr><td colspan="7"></td></tr>  
</TABLE>
<input type="hidden" name="Size_Parameter_Cat" id="Size_Parameter_Cat" value="@(string.IsNullOrEmpty(Size_Parameter_Cat) ? "" : Size_Parameter_Cat)" >
<br>
<p style="font-weight: bold;"><span style="color: red;">*</span> @ReportLocalizer["TS_afterCPI"]: </p>

<table style="width: 100%; padding: 0px; ">
    <tr style="height: 0px;">
        <td style="width: 20%;"></td>
        <td style="width: 13%;"></td>
        <td style="width: 13%;"></td>
        <td style="width: 13%;"></td>
        <td style="width: 13%;"></td>
        <td style="width: 13%;"></td>
        <td style="width: 13%;"></td>
    </tr>
@if(!string.IsNullOrEmpty(Size_Parameter_CPI))
{
    Size_Parameter_CPI = Size_Parameter_CPI.Trim('*');
    var arrSizePara_CPI = Size_Parameter_CPI.Split('*');
    @for (int i =0; i< arrSizePara_CPI.Length; i++){
        var SizePara_CPI = arrSizePara_CPI[i];
        var arrPara_CPI = SizePara_CPI.Split('@');

        <tr id="@(i == 0 ? "CPI_R1" : null)" style="width:90%;">
            @* Duyệt các phần tử trong arrPara *@
            <td>
                <input type="text" value="@arrPara_CPI.ElementAtOrDefault(0)" style="color:#360; width:80%;" autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara_CPI.ElementAtOrDefault(1)" style="color:#360; width:80%;" autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara_CPI.ElementAtOrDefault(2)" style="color:#360; width:80%;" autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara_CPI.ElementAtOrDefault(3)" style="color:#360; width:80%;" autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara_CPI.ElementAtOrDefault(4)" style="color:#360; width:80%;" autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara_CPI.ElementAtOrDefault(5)" style="color:#360; width:80%;" autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara_CPI.ElementAtOrDefault(6)" style="color:#360; width:80%;" autocomplete="on" />
            </td>
            
        </tr>
    }  
}
else
{
    
}
<tr><td colspan="7"></td></tr>  
</TABLE>   
<input type="hidden" name="Size_Parameter_CPI" id="Size_Parameter_CPI" value="@(string.IsNullOrEmpty(Size_Parameter_CPI) ? "" : Size_Parameter_CPI)" >
<br>
<p style="font-weight: bold;"><span style="color: red;">*</span> @ReportLocalizer["TS_TP"]: </p>

<table style="width: 100%; padding: 0px; ">
    <tr style="height: 0px;">
        <td style="width: 20%;"></td>
        <td style="width: 13%;"></td>
        <td style="width: 13%;"></td>
        <td style="width: 13%;"></td>
        <td style="width: 13%;"></td>
        <td style="width: 13%;"></td>
        <td style="width: 13%;"></td>
    </tr>
@if(!string.IsNullOrEmpty(Size_Parameter_TP))
{
    Size_Parameter_TP = Size_Parameter_TP.Trim('*');
    var arrSizePara_TP = Size_Parameter_TP.Split('*');
    @for (int i =0; i< arrSizePara_TP.Length; i++){
        var SizePara_TP = arrSizePara_TP[i];
        var arrPara_TP = SizePara_TP.Split('@');

        <tr id="@(i == 0 ? "TP_R1" : null)" style="width:90%;">
            @* Duyệt các phần tử trong arrPara *@
            <td>
                <input type="text" value="@arrPara_TP.ElementAtOrDefault(0)" style="color:#360; width:80%;" autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara_TP.ElementAtOrDefault(1)" style="color:#360; width:80%;" autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara_TP.ElementAtOrDefault(2)" style="color:#360; width:80%;" autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara_TP.ElementAtOrDefault(3)" style="color:#360; width:80%;" autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara_TP.ElementAtOrDefault(4)" style="color:#360; width:80%;" autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara_TP.ElementAtOrDefault(5)" style="color:#360; width:80%;" autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara_TP.ElementAtOrDefault(6)" style="color:#360; width:80%;" autocomplete="on" />
            </td>
            
        </tr>
    }  
}
else
{
    
}
<tr><td colspan="7"></td></tr>  
</TABLE>   
<input type="hidden" name="Size_Parameter_TP" id="Size_Parameter_TP" value="@(string.IsNullOrEmpty(Size_Parameter_TP) ? "" : Size_Parameter_TP)" >


<p style="font-weight: bold; text-align: left;"><span style="color: red;">*</span> @Localizer["Remark"]:</p>
<textarea rows="4" cols="100" name="Remark" id="Remark" onClick="this.select();" > @(string.IsNullOrEmpty(Model.Remark) ? "" : Model.Remark)</textarea>

<p style="font-weight: bold;"><span style="color: red;">*</span>@ReportLocalizer["ImgError"]:</p>
@if(!string.IsNullOrEmpty(Model.Photo_URL))
{
    var photos = Model.Photo_URL.Split(";");
    foreach(var photo in photos)
    {
        if(!string.IsNullOrEmpty(photo))
        {
            <img src="~/upload/Photos/Form3_BCDT/@photo" style='width:100px;' onclick='Show_Photo("@photo")'/>
        }
    }
}

<p style="font-weight: bold;">
    <span style="color: red;">*</span> @ReportLocalizer["ReAudit"]: &nbsp;
    <input type="checkbox" name="Re_Audit" id="Re_Audit"  value="true" @(Model.Re_Audit == true ? "checked" : "") value="0" style="  color:#360; font-size:20px; zoom:3.0;"  autocomplete="on" />   
    <input type="hidden" name="Audit_Time" id="Audit_Time" value="@(Model.Audit_Time >0 ? Model.Audit_Time : 0)" >
</p>


<br>
    <p style="text-align: center; display: block;">
        <button type="button" class="btn btn-danger" onClick="Delete_Click1();" title="Delete this report" >@Localizer["Delete"]</button> 
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">@Localizer["Close"]</button>
    </p>
    
<br>
</form>

<!-- Modal Show anh loi -->
	<div id="Modal_Photo" class="modal" style="height: 100%;"> 
        <!-- Modal content -->
          <div class="modal-content">
            <div class="modal-header bg-success text-center">
              <span class="close" id="close_Modal_Photo">&times;</span>
              <h2 style="text-align: center; text-transform: uppercase;"> @ReportLocalizer["ImgError"]</h2> 
            </div>
            <div class="modal-body" style="text-align: center;">
                <img src="" style="width: 90%"  id="Fault_Photo" align="center">
            </div>
          </div>
    </div>

<script>
    function Delete_Click1() {
        var reportId = $("#ReportID").val();
        var audit_Time = $("#Audit_Time").val();
        if (reportId == "" || reportId == null) {
            alert("Report ID is missing!");
            return false;
        }

        if (confirm("Are you sure you want to delete this report?")) {
            $.post('@Url.Action("DeleteReport", "Form3BCDT", new { area = "Report" })',
                { reportId: reportId, audit_Time: audit_Time },
                function (data) {
                    if (data.success) {
                        alert("Report deleted successfully.");
                        // Redirect to another page or refresh
                        var Unit = $("#Unit").val();
                        var dateFrom = $("#dateFrom").val();
                        var dateEnd = $("#dateEnd").val();

                        window.location.href = '@Url.Action("RP_Form3", "Form3BCDT", new { area = "Report" })' + '?Unit=' + Unit + '&dateFrom=' + dateFrom + '&dateEnd=' + dateEnd;
                    } else {
                        alert("Error deleting report: " + data.message);
                    }
                }
            );
        }
    }


function Show_Photo(img)
{
	// Get the modal
    var modal = document.getElementById('Modal_Photo');
    // Get the <span> element that closes the modal
    var span = document.getElementById('close_Modal_Photo');
    
     modal.style.display = "block";
     document.getElementById("Fault_Photo").src= '/upload/Photos/Form3_BCDT/'+img;
     
     // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
        modal.style.display = "none";
    }
    
    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
}

</script>