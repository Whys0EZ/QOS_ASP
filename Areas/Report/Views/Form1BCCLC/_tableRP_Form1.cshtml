@model QOS.Areas.Report.Models.Form1_BCCLC
@inject Microsoft.Extensions.Localization.IStringLocalizer<QOS.SharedResource> Localizer
@inject Microsoft.Extensions.Localization.IStringLocalizer<QOS.Areas.Report.SharedResource> ReportLocalizer
@{
    
    var Size_Parameter = Model.Size_Parameter;
    decimal DS_L_Min = ConvertToDecimal(Model.DS_L_Min), DS_L_Max = ConvertToDecimal(Model.DS_L_Max);
    decimal DS_W_Min = ConvertToDecimal(Model.DS_W_Min), DS_W_Max = ConvertToDecimal(Model.DS_W_Max);

    decimal DS_L_Min_2 = ConvertToDecimal(Model.DS_L_Min_2), DS_L_Max_2 = ConvertToDecimal(Model.DS_L_Max_2);
    decimal DS_W_Min_2 = ConvertToDecimal(Model.DS_W_Min_2), DS_W_Max_2 = ConvertToDecimal(Model.DS_W_Max_2);
    
}
<form id="Form1Report" method="post" asp-action="CreateReport_Form1" asp-controller="Report" asp-area="Report">
    <input type="hidden" id="ReportID" name="ReportID" value="@Model.ID"/>
<table class="table">
    <tr>
        <td><label>@Localizer["Unit"]</label></td>
        <td><label>@ReportLocalizer["CutLeader"]</label></td>
        <td><label>@ReportLocalizer["CutTable"]</label></td>
        <td><label>@ReportLocalizer["CutTableName"]</label></td>     
    </tr>
    <tr>
        <td><input id="UnitField" value="@Model.Unit"/></td>
        <td><input value="@Model.Cut_Leader"/></td>
        <td><input value="@Model.Cut_Lot"/></td>
        <td><input value="@Model.CutTableName"/></td>

    </tr>
    <tr>
        <td><label>@ReportLocalizer["CutTableRatio"]</label></td>
        <td><label>@ReportLocalizer["Lay_Height"]</label></td>
        <td><label>@ReportLocalizer["Table_Long"]</label></td>
        <td><label>@ReportLocalizer["Table_Width"]</label></td>     
    </tr>
    <tr>
        <td><input value="@Model.CutTableRatio" /></td>
        <td><input value="@Model.Lay_Height" /></td>
        <td><input value="@Model.Table_Long" /></td>
        <td><input value="@Model.Table_Width" /></td>

    </tr>
    <tr>
        <td><label>MO: </label></td>
        <td><label>@Localizer["Color"]: </label></td>
        <td><label>@ReportLocalizer["Batch"]: </label></td>
        <td><label>@ReportLocalizer["Qty"]: </label></td>     
    </tr>
    <tr>
        <td><input value="@Model.MO"/></td>
        <td><input value="@Model.Color"/></td>
        <td><input value="@Model.Batch"/></td>
        <td><input value="@Model.Cut_QTY"/></td>
    </tr>
    <tr>
        <td colspan="4"><label>@ReportLocalizer["QualityFabric"]: </label><i style="color: red;">(@ReportLocalizer["CheckboxE"])</i></td>
    </tr>
    <tr>
        <td style="padding: 3px; text-align:center;">
                <div>@ReportLocalizer["Shading"]</div>
                <input type="checkbox" name="F1_chk_loang_mau" value="true" @(Model.Shading == true ? "checked" : "") id="F1_chk_loang_mau"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
        <td style="padding: 3px; text-align:center;">
                <div>@ReportLocalizer["Wave"]</div>
                <input type="checkbox" name="F1_chk_song_vai"  value="true" @(Model.Wave == true ? "checked" : "") id="F1_chk_song_vai"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
        <td style="padding: 3px; text-align:center;">
                <div>@ReportLocalizer["Narrow_Width"]</div>
                <input type="checkbox" name="F1_chk_hep_kho"   value="true" @(Model.Narrow_Width == true ? "checked" : "") id="F1_chk_hep_kho"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
        <td style="padding: 3px; text-align:center;">
                <div>@ReportLocalizer["Spreading"]</div>
                <input type="checkbox" name="F1_chk_trai_vai"  value="true" @(Model.Spreading == true ? "checked" : "") id="F1_chk_trai_vai"  value="1" style="zoom:3.0;"  autocomplete="on" />
        </td>
    </tr>
</table>
<table class="table">
    <tr>
        <td width="50%">
            <i style="color: red;">*</i> <label>@ReportLocalizer["Tolerance1"]:</label>
        </td>
        <td width="50%">
            <i style="color: red;">*</i> <label>@ReportLocalizer["Tolerance1"]:</label>
        </td>
    </tr>
    <tr>
        <td>
            <p>
                @ReportLocalizer["longTo"] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="text" name="DS_L_Min" id="DS_L_Min" value="@(string.IsNullOrEmpty(Model.DS_L_Min) ? "0" : Model.DS_L_Min)" />  @ReportLocalizer["To"] <input type="text" name="DS_L_Max" id="DS_L_Max" value="@(string.IsNullOrEmpty(Model.DS_L_Max) ? "0" : Model.DS_L_Max)" />
            </p>
        </td>
        <td>
            <p>
                @ReportLocalizer["longTo"] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="text" name="DS_L_Min_2" id="DS_L_Min_2" value="@(string.IsNullOrEmpty(Model.DS_L_Min_2) ? "0" : Model.DS_L_Min_2)" />  @ReportLocalizer["To"] <input type="text" name="DS_L_Max_2" id="DS_L_Max_2" value="@(string.IsNullOrEmpty(Model.DS_L_Max_2) ? "0" : Model.DS_L_Max_2)" />
            </p>
        </td>
    </tr>
    <tr></tr>
        <td>
            <p>
                @ReportLocalizer["widthTo"] &nbsp;&nbsp;&nbsp;
                <input type="text" name="DS_W_Min" id="DS_W_Min" value="@(string.IsNullOrEmpty(Model.DS_W_Min) ? "0" : Model.DS_W_Min)" />  @ReportLocalizer["To"] <input type="text" name="DS_W_Max" id="DS_W_Max" value="@(string.IsNullOrEmpty(Model.DS_W_Max) ? "0" : Model.DS_W_Max)" />
            </p>
        </td>
        <td>
            <p>
                @ReportLocalizer["widthTo"] &nbsp;&nbsp;&nbsp;
                <input type="text" name="DS_W_Min_2" id="DS_W_Min_2" value="@(string.IsNullOrEmpty(Model.DS_W_Min_2) ? "0" : Model.DS_W_Min_2)" />  @ReportLocalizer["To"] <input type="text" name="DS_W_Max_2" id="DS_W_Max_2" value="@(string.IsNullOrEmpty(Model.DS_W_Max_2) ? "0" : Model.DS_W_Max_2)" />
            </p>
        </td>
    </tr>
</table>

<p style="font-weight: bold;"><span style="color: red;">*</span> @ReportLocalizer["ParametersLW"]:</p>
<TABLE style="width: 100%; border: 1px solid gray !important; padding: 0px; display: inherit; " cell-padding="0px" cell-spacing="5px"  >
    <tr style="text-align: center;">
        <th style="width: 40%;">@Localizer["Size"]</th>
        <th style=""></th>
        <th colspan="2">@ReportLocalizer["Firstleaves"]</th>
        <th colspan="2">@ReportLocalizer["Middleleaves"]</th>
        <th colspan="2">@ReportLocalizer["Lastleaves"]</th>
    </tr>

@functions {
    private decimal ConvertToDecimal(string? val)
    {
        if (decimal.TryParse(val, out var num))
            return num;
        return 0;
    }

    public string Show_DS(string dsmin, string dsmax, string x)
    {
        // default màu xanh
        string dscolor = "#360";

        if (!decimal.TryParse(dsmin, out var min)) min = 0;
        if (!decimal.TryParse(dsmax, out var max)) max = 0;
        if (!decimal.TryParse(x, out var value)) value = 0;

        if (value < min || value > max)
        {
            dscolor = "#F00"; // đỏ nếu nằm ngoài khoảng
        }

        return dscolor;
    }
}

@if(!string.IsNullOrEmpty(Size_Parameter))
{
    Size_Parameter = Size_Parameter.Trim('*');
    var arrSizePara = Size_Parameter.Split('*');
    @for (int i =0; i< arrSizePara.Length; i++){
        var SizePara = arrSizePara[i];
        var arrPara = SizePara.Split('@');

        <tr id="@(i == 0 ? "Fault_R1" : null)" style="width:100%;">
            @* Duyệt các phần tử trong arrPara *@
            <td>
                <input type="text" value="@arrPara.ElementAtOrDefault(0)" style="color:#360; width:95%;" autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@(string.IsNullOrEmpty(arrPara.ElementAtOrDefault(7)) ? "Tol 1" : arrPara[7])"
                       style="color:#360; width:100px;" autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara.ElementAtOrDefault(1)"
                       style="color:@(arrPara.ElementAtOrDefault(7) == "Tol 2" 
                                    ? Show_DS(DS_L_Min_2.ToString(), DS_L_Max_2.ToString(), arrPara.ElementAtOrDefault(1) ?? "0") 
                                    : Show_DS(DS_L_Min.ToString(), DS_L_Max.ToString(), arrPara.ElementAtOrDefault(1) ?? "0")); width:100px;"
                       autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara.ElementAtOrDefault(2)"
                       style="color:@(arrPara.ElementAtOrDefault(7) == "Tol 2" 
                                    ? Show_DS(DS_W_Min_2.ToString(), DS_W_Max_2.ToString(), arrPara.ElementAtOrDefault(2) ?? "0") 
                                    : Show_DS(DS_W_Min.ToString(), DS_W_Max.ToString(), arrPara.ElementAtOrDefault(2) ?? "0")); width:100px;"
                       autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara.ElementAtOrDefault(3)"
                       style="color:@(arrPara.ElementAtOrDefault(7) == "Tol 2" 
                                    ? Show_DS(DS_L_Min_2.ToString(), DS_L_Max_2.ToString(), arrPara.ElementAtOrDefault(3) ?? "0") 
                                    : Show_DS(DS_L_Min.ToString(), DS_L_Max.ToString(), arrPara.ElementAtOrDefault(3) ?? "0")); width:100px;"
                       autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara.ElementAtOrDefault(4)"
                       style="color:@(arrPara.ElementAtOrDefault(7) == "Tol 2" 
                                    ? Show_DS(DS_W_Min_2.ToString(), DS_W_Max_2.ToString(), arrPara.ElementAtOrDefault(4) ?? "0") 
                                    : Show_DS(DS_W_Min.ToString(), DS_W_Max.ToString(), arrPara.ElementAtOrDefault(4) ?? "0")); width:100px;"
                       autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara.ElementAtOrDefault(5)"
                       style="color:@(arrPara.ElementAtOrDefault(7) == "Tol 2" 
                                    ? Show_DS(DS_L_Min_2.ToString(), DS_L_Max_2.ToString(), arrPara.ElementAtOrDefault(5) ?? "0") 
                                    : Show_DS(DS_L_Min.ToString(), DS_L_Max.ToString(), arrPara.ElementAtOrDefault(5) ?? "0")); width:100px;"
                       autocomplete="on" />
            </td>
            <td>
                <input type="text" value="@arrPara.ElementAtOrDefault(6)"
                       style="color:@(arrPara.ElementAtOrDefault(7) == "Tol 2" 
                                    ? Show_DS(DS_W_Min_2.ToString(), DS_W_Max_2.ToString(), arrPara.ElementAtOrDefault(6) ?? "0") 
                                    : Show_DS(DS_W_Min.ToString(), DS_W_Max.ToString(), arrPara.ElementAtOrDefault(6) ?? "0")); width:100px;"
                       autocomplete="on" />
            </td>
            
        </tr>
    }  
}
else
{
    <tr id="Fault_R1">
        <td><input type="text" value="" style="color:#360; width:95%;" autocomplete="on" /></td>
        <td><input type="text" value="Tol" style="color:#360;" autocomplete="on" /></td>
        <td><input type="text" value="0" style="color:#360;" autocomplete="on" /></td>
        <td><input type="text" value="0" style="color:#360;" autocomplete="on" /></td>
        <td><input type="text" value="0" style="color:#360;" autocomplete="on" /></td>
        <td><input type="text" value="0" style="color:#360;" autocomplete="on" /></td>
        <td><input type="text" value="0" style="color:#360;" autocomplete="on" /></td>
    </tr>
}
<tr><td colspan="7"></td></tr>  
</TABLE>


<p style="font-weight: bold;"><span style="color: red;">*</span> @ReportLocalizer["QualityCut"]:</p>
<TABLE style="width: 100%; font-size: 0.8em!important; border: 1px solid gray; ">
    <tr style="text-align: left;">
        <td>
                @ReportLocalizer["Notch"]: <br>
                <input type="text" name="Notch" id="Notch" value="@(string.IsNullOrEmpty(Model.Notch) ? "" : Model.Notch)" style="  color:#360; width: 90%;"  autocomplete="on" />
        </td>
        <td>
                @ReportLocalizer["Unclean"]: <br>
                <input type="text" name="Unclean" id="Unclean"  value="@(string.IsNullOrEmpty(Model.Unclean) ? "" : Model.Unclean)" style="  color:#360; width: 90%;"  autocomplete="on" />
        </td>
        <td>
                @ReportLocalizer["Straigh"]: <br>
                <input type="text" name="Straigh" id="Straigh"  value="@(string.IsNullOrEmpty(Model.Straigh) ? "" : Model.Straigh)" style="  color:#360; width: 90%;"  autocomplete="on" />
        </td>
    </tr>
    <tr style="text-align: left;">
        <td>
                @ReportLocalizer["Shape"]: <br>
                <input type="text" name="Shape" id="Shape"   value="@(string.IsNullOrEmpty(Model.Shape) ? "" : Model.Shape)" style="  color:#360; width: 90%;"  autocomplete="on" />
        </td>
        <td>
                @ReportLocalizer["Edge"]: <br>
                <input type="text" name="Edge" id="Edge"   value="@(string.IsNullOrEmpty(Model.Edge) ? "" : Model.Edge)" style="  color:#360; width: 90%;"  autocomplete="on" />
        </td>
        <td>
                @ReportLocalizer["Stripe"]: <br>
                <input type="text" name="Stripe" id="Stripe"   value="@(string.IsNullOrEmpty(Model.Stripe) ? "" : Model.Stripe)" style="  color:#360; width: 90%;"  autocomplete="on" />
        </td>

    </tr>
</TABLE>

<p style="font-weight: bold; text-align: left;"><span style="color: red;">*</span> @Localizer["Remark"]:</p>
<textarea rows="4" cols="100" name="Remark" id="Remark" onClick="this.select();" > @(string.IsNullOrEmpty(Model.Remark) ? "" : Model.Remark)</textarea>

<p style="font-weight: bold;"><span style="color: red;">*</span>@ReportLocalizer["ImgError"]:</p>
@if(!string.IsNullOrEmpty(Model.Photo_URL))
{
    var photos = Model.Photo_URL.Split(";");
    foreach(var photo in photos)
    {
        if(!string.IsNullOrEmpty(photo))
        {
            <img src="~/upload/Photos/Form1_BCCLC/@photo" style='width:100px;' onclick='Show_Photo("@photo")'/>
        }
    }
}

<p style="font-weight: bold;">
    <span style="color: red;">*</span> @ReportLocalizer["ReAudit"]: &nbsp;
    <input type="checkbox" name="Re_Audit" id="Re_Audit"  value="true" @(Model.Re_Audit == true ? "checked" : "") value="0" style="  color:#360; font-size:20px; zoom:3.0;"  autocomplete="on" />   
</p>


<br>
    <p style="text-align: center; display: block;">
        <button type="button" class="btn btn-danger" onClick="Delete_Click1();" title="Delete this report" >@Localizer["Delete"]</button> 
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">@Localizer["Close"]</button>
    </p>
    
<br>
</form>

<!-- Modal Show anh loi -->
	<div id="Modal_Photo" class="modal" style="height: 100%;"> 
        <!-- Modal content -->
          <div class="modal-content">
            <div class="modal-header bg-success text-center">
              <span class="close" id="close_Modal_Photo">&times;</span>
              <h2 style="text-align: center; text-transform: uppercase;"> @ReportLocalizer["ImgError"] </h2> 
            </div>
            <div class="modal-body" style="text-align: center;">
                <img src="" style="width: 90%"  id="Fault_Photo" align="center">
            </div>
          </div>
    </div>

<script>
    function Delete_Click1() {
        var reportId = $("#ReportID").val();
        if (reportId == "" || reportId == null) {
            alert("Report ID is missing!");
            return false;
        }

        if (confirm("Are you sure you want to delete this report?")) {
            $.post('@Url.Action("DeleteReport", "Form1BCCLC", new { area = "Report" })',
                { reportId: reportId },
                function (data) {
                    if (data.success) {
                        alert("Report deleted successfully.");
                        // Redirect to another page or refresh
                        var Unit = $("#Unit").val();
                        var dateFrom = $("#dateFrom").val();
                        var dateEnd = $("#dateEnd").val();

                        window.location.href = '@Url.Action("RP_Form1", "Form1BCCLC", new { area = "Report" })' + '?Unit=' + Unit + '&dateFrom=' + dateFrom + '&dateEnd=' + dateEnd;
                    } else {
                        alert("Error deleting report: " + data.message);
                    }
                }
            );
        }
    }


function Show_Photo(img)
{
	// Get the modal
    var modal = document.getElementById('Modal_Photo');
    // Get the <span> element that closes the modal
    var span = document.getElementById('close_Modal_Photo');
    
     modal.style.display = "block";
     document.getElementById("Fault_Photo").src= '/upload/Photos/Form1_BCCLC/'+img;
     
     // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
        modal.style.display = "none";
    }
    
    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
}

</script>