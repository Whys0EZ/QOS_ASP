@model IEnumerable<QOS.Areas.Function.Models.GroupContactList>
@{
    ViewData["Title"] = "Tracking Contact";
    Layout = "_MenuFunction";
}

<partial name="_AlertMessage" />
<div class="continer my-3">
    

<button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#groupModal">ThÃªm Group</button>
<div>
    @if (Model != null && Model.Any())
    {
        <table class="table table-bordered table-striped mt-3">
            <thead class="table-dark">
                <tr>
                    <th>STT</th>
                    <th>ModuleName</th>
                    <th>GroupID</th>
                    <th>GroupName</th>
                    <th>ContactList</th>
                    <th>UserUpdate</th>
                    <th>Remark</th>
                    <th>LastUpdate</th>
                </tr>
            </thead>
            <tbody>
                @{
                    var i = 1;
                }
                @foreach (var u in Model)
                {
                    <tr class="row-click" 
                    data-stt="@u.STT"
                    data-modulename="@u.ModuleName"
                    data-groupid="@u.GroupID"
                    data-groupname="@u.GroupName"
                    data-contactlist="@u.ContactList"
                    data-userupdate="@u.UserUpdate"
                    data-remark="@u.Remark"
                    data-lastupdate="@u.LastUpdate">
                    <td>@u.STT</td>
                    <td>@u.ModuleName</td>
                    <td>@u.GroupID</td>
                    <td>@u.GroupName</td>
                    <td>@u.ContactList</td>
                    <td>@u.UserUpdate</td>
                    <td>@u.Remark</td>
                    <td>@u.LastUpdate</td>
                    </tr>
                    i++;
                }

            </tbody>
        </table>
    }
</div>

<!-- Popup Modal -->
<div class="modal fade" id="groupModal" tabindex="-1">
  <div class="modal-dialog modal-fullscreen">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-primary text-uppercase fs-2 fw-semibold">Sá»­a Group Contact</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="groupForm">
          <input type="hidden" name="GroupID_old" id="GroupID_old" />

          <div class="mb-3">
            <label>STT</label>
            <input type="text" class="form-control" name="STT" id="STT" />
          </div>
          <div class="mb-3">
            <label>ModuleName</label>
            <input type="text" class="form-control" name="ModuleName" id="ModuleName" />
          </div>
          <div class="mb-3">
            <label>GroupID</label>
            <input type="text" class="form-control" name="GroupID" id="GroupID" />
          </div>
          <div class="mb-3">
            <label>GroupName</label>
            <input type="text" class="form-control" name="GroupName" id="GroupName" />
          </div>
          <div class="mb-3">
            <label>ContactList</label>
            <textarea style="height: 120px" class="form-control" name="ContactList" id="ContactList"></textarea>
          </div>
          <div class="mb-3">
            <label>Remark</label>
            <textarea class="form-control" name="Remark" id="Remark"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" id="btnSave" class="btn btn-success">Save</button>
        <button type="button" id="btnDelete" class="btn btn-danger">Delete</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
@* <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> *@
<script src="~/js/jquery-3.6.0.min.js"></script>
<script>

$(document).ready(function () {
        // Reset form khi nháº¥n nÃºt ThÃªm Group
    $("button[data-bs-target='#groupModal']").click(function () {
        $("#groupForm")[0].reset();  // reset form
        $("#GroupID_old").val("");   // clear hidden key Ä‘á»ƒ biáº¿t lÃ  Ä‘ang thÃªm má»›i
        $("#btnDelete").hide();      // áº©n nÃºt Delete khi thÃªm
        $(".modal-title").text("ThÃªm Group Contact");
    });
    // Khi click vÃ o dÃ²ng
    $(".row-click").click(function () {
        var row = $(this);

        $("#STT").val(row.data("stt"));
        $("#ModuleName").val(row.data("modulename"));
        $("#GroupID").val(row.data("groupid"));
        $("#GroupName").val(row.data("groupname"));
        $("#ContactList").val(row.data("contactlist"));
        $("#Remark").val(row.data("remark"));

        $("#GroupID_old").val(row.data("groupid")); // lÆ°u láº¡i Ä‘á»ƒ update
        $("#btnDelete").show();   // ðŸ‘ˆ hiá»‡n nÃºt Delete khi edit
        $(".modal-title").text("Sá»­a Group Contact"); // Ä‘á»•i title luÃ´n cho rÃµ
        $("#groupModal").modal("show");
    });

    // Save
    $("#btnSave").click(function () {
        $.post('@Url.Action("Save","TrackingContact",new {area="Function"})',
            $("#groupForm").serialize(),
            function (res) {
                alert(res.message);
                if (res.success) {
                    $("#groupModal").modal("hide");
                    location.reload();
                }
            });
    });

    // Delete
    $("#btnDelete").click(function () {
        if (!confirm("Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a?")) return;
        $.post('@Url.Action("Delete","TrackingContact",new {area="Function"})',
            { GroupID_old: $("#GroupID_old").val() },
            function (res) {
                alert(res.message);
                if (res.success) {
                    $("#groupModal").modal("hide");
                    location.reload();
                }
            });
    });
});

</script>